# COBOL Program Analysis Report

**Analysis Date:** Generated by COBOL Analyzer  
**Directory:** /home/runner/work/Cobol-Demo/Cobol-Demo/AS400/COBOL_examples/Holidays/QCBLLESRC  
**Programs Analyzed:** 2

---

## Table of Contents
1. [Program Overview](#program-overview)
2. [CANDAY01.CBLLE - Canada Day Calculator](#canday01cblle---canada-day-calculator)
3. [TESTCDAY.CBLLE - Test Program](#testcdaycblle---test-program)
4. [Cross-Program Relationships](#cross-program-relationships)
5. [Summary](#summary)

---

## Program Overview

This directory contains two COBOL programs related to Canada Day calculation:
- **CANDAY01.CBLLE**: Main calculator program that determines what day of the week Canada Day (July 1st) falls on for any given year
- **TESTCDAY.CBLLE**: Automated test program designed to test CANDAY01

---

## CANDAY01.CBLLE - Canada Day Calculator

### Program Identification
- **Program ID:** CANDAY01
- **Author:** Development Team
- **Date Written:** July 21, 2025
- **Purpose:** Determines what day of the week Canada Day (July 1st) falls on for any given year (historical or future)

### Environment Division

#### Configuration Section
- **Special Names:** DECIMAL-POINT IS COMMA

### Data Division

#### Working-Storage Section

##### 1. Input Year Fields (Lines 22-23)
```
01 WS-INPUT-YEAR          PIC 9(4) VALUE ZEROS
   - Level: 01
   - Type: Numeric
   - Size: 4 digits
   - Purpose: Stores the year input from user
   - Initial Value: 0000

01 WS-INPUT-YEAR-DISPLAY  PIC Z(4)
   - Level: 01
   - Type: Numeric (Display format with leading zero suppression)
   - Size: 4 characters
   - Purpose: Formatted display of input year
```

##### 2. Date Calculation Fields (Lines 26-29)
```
01 WS-CANADA-DATE         (Group Level)
   - Level: 01
   - Type: Group item
   - Purpose: Holds the complete Canada Day date components
   
   05 WS-YEAR             PIC 9(4)
      - Level: 05 (subordinate to WS-CANADA-DATE)
      - Type: Numeric
      - Size: 4 digits
      - Purpose: Year component of Canada Day
   
   05 WS-MONTH            PIC 9(2) VALUE 07
      - Level: 05
      - Type: Numeric
      - Size: 2 digits
      - Purpose: Month component (always July = 07)
      - Initial Value: 07
   
   05 WS-DAY              PIC 9(2) VALUE 01
      - Level: 05
      - Type: Numeric
      - Size: 2 digits
      - Purpose: Day component (always 1st = 01)
      - Initial Value: 01
```

##### 3. Day of Week Calculation Fields (Lines 32-33)
```
01 WS-DAY-OF-WEEK         PIC 9(1)
   - Level: 01
   - Type: Numeric
   - Size: 1 digit
   - Purpose: Numeric representation of day (1-7)

01 WS-DAY-NAME            PIC X(9)
   - Level: 01
   - Type: Alphanumeric
   - Size: 9 characters
   - Purpose: Text name of the day of week
```

##### 4. Date Manipulation Fields (Lines 36-37)
```
01 WS-DATE-NUMERIC        PIC 9(8)
   - Level: 01
   - Type: Numeric
   - Size: 8 digits
   - Purpose: Date in YYYYMMDD format for calculations

01 WS-DATE-FORMATTED      PIC X(10)
   - Level: 01
   - Type: Alphanumeric
   - Size: 10 characters
   - Purpose: Formatted date string (currently unused in program)
```

##### 5. Day Name Table (Lines 40-50)
```
01 WS-DAY-TABLE           (Group Level - Table Definition)
   - Level: 01
   - Type: Group item containing 7 FILLER entries
   - Purpose: Stores day names for lookup
   
   05 FILLER              PIC X(9) VALUE 'Sunday   '
   05 FILLER              PIC X(9) VALUE 'Monday   '
   05 FILLER              PIC X(9) VALUE 'Tuesday  '
   05 FILLER              PIC X(9) VALUE 'Wednesday'
   05 FILLER              PIC X(9) VALUE 'Thursday '
   05 FILLER              PIC X(9) VALUE 'Friday   '
   05 FILLER              PIC X(9) VALUE 'Saturday '

01 WS-DAY-NAMES REDEFINES WS-DAY-TABLE
   - REDEFINES: WS-DAY-TABLE (same memory space)
   - Purpose: Array accessor for day names
   
   05 WS-DAY-ENTRY        PIC X(9) OCCURS 7 TIMES
      - Level: 05
      - Type: Alphanumeric array
      - Size: 9 characters per entry
      - Occurrences: 7 (one for each day)
      - Purpose: Individual day name accessor
```

##### 6. Error Handling Fields (Lines 53-54)
```
01 WS-ERROR-FLAG          PIC X(1) VALUE 'N'
   - Level: 01
   - Type: Alphanumeric
   - Size: 1 character
   - Purpose: Indicates validation errors ('Y'/'N')
   - Initial Value: 'N'

01 WS-CONTINUE-FLAG       PIC X(1) VALUE 'Y'
   - Level: 01
   - Type: Alphanumeric
   - Size: 1 character
   - Purpose: Controls program loop continuation ('Y'/'N')
   - Initial Value: 'Y'
```

##### 7. Display Formatting Fields (Line 57)
```
01 WS-DISPLAY-LINE        PIC X(80)
   - Level: 01
   - Type: Alphanumeric
   - Size: 80 characters
   - Purpose: Formatted output line buffer
```

### Procedure Division

#### Main Control Flow

##### MAIN-PROCEDURE (Lines 61-80)
**Purpose:** Primary program entry point and control loop

**Logic Flow:**
1. Display program header and title
2. Enter main processing loop (PERFORM UNTIL WS-CONTINUE-FLAG = 'N')
   - Get year input from user
   - If no errors, calculate day of week
   - Display results
   - Ask user to continue
3. Display exit message
4. GOBACK to calling program

**Calls/Performs:**
- `PERFORM GET-YEAR-INPUT` (Line 70)
- `PERFORM CALCULATE-DAY-OF-WEEK` (Line 72)
- `PERFORM DISPLAY-RESULT` (Line 73)
- `PERFORM ASK-CONTINUE` (Line 75)

**Exit:** GOBACK (Line 80)

---

#### GET-YEAR-INPUT SECTION (Lines 82-94)
**Purpose:** Accept and validate year input from user

**Logic Flow:**
1. Reset error flag to 'N'
2. Prompt user for year input (1600-3000)
3. Accept year from user input
4. Validate year range:
   - If year < 1600 OR year > 3000:
     - Display error message
     - Set error flag to 'Y'
   - Else:
     - Move input year to WS-YEAR

**Variables Modified:**
- WS-ERROR-FLAG
- WS-INPUT-YEAR (via ACCEPT)
- WS-YEAR

**Input Validation:**
- Range: 1600 to 3000 (inclusive)
- Error handling via WS-ERROR-FLAG

---

#### CALCULATE-DAY-OF-WEEK SECTION (Lines 96-116)
**Purpose:** Calculate which day of the week Canada Day falls on for given year

**Logic Flow:**
1. Build date in YYYYMMDD format:
   - Move WS-YEAR to positions 1-4 of WS-DATE-NUMERIC
   - Move WS-MONTH (07) to positions 5-6
   - Move WS-DAY (01) to positions 7-8
2. Calculate day of week using intrinsic functions:
   - Use FUNCTION INTEGER-OF-DATE to convert date to integer
   - Apply MOD 7 to get day of week (0-6)
   - Add 1 to adjust to 1-7 range
3. Adjust for table indexing (Sunday=1, Monday=2, etc.):
   - If result = 7, set to 1 (Sunday)
   - Else add 1 to result
4. Retrieve day name from WS-DAY-ENTRY array

**Variables Modified:**
- WS-DATE-NUMERIC (Lines 98-100)
- WS-DAY-OF-WEEK (Lines 104-112)
- WS-DAY-NAME (Line 116)

**COBOL Intrinsic Functions Used:**
- `FUNCTION INTEGER-OF-DATE(WS-DATE-NUMERIC)` - Converts date to integer days since base date
- `FUNCTION MOD(value, 7)` - Returns remainder of division by 7

**Algorithm:**
- Uses Zeller's congruence-style calculation via COBOL intrinsic functions
- INTEGER-OF-DATE returns days since a base date (implementation-specific)
- MOD 7 gives day of week (0-6)
- Adjustment logic maps to table index (1-7)

---

#### DISPLAY-RESULT SECTION (Lines 118-147)
**Purpose:** Format and display the calculated result with additional information

**Logic Flow:**
1. Format input year for display (with leading zero suppression)
2. Display result header
3. Build and display main result message using STRING verb:
   - "Canada Day (July 1, [YEAR]) falls on a [DAY NAME]"
4. Display fun facts based on day of week:
   - If Saturday or Sunday: weekend celebration message
   - If weekday: long weekend message
   - If Monday: special Monday message
   - If Friday: special Friday message

**Variables Modified:**
- WS-INPUT-YEAR-DISPLAY (Line 119)
- WS-DISPLAY-LINE (Lines 123-128)

**String Operations:**
- Uses STRING verb with DELIMITED BY SIZE (Lines 123-128)
- Concatenates multiple string literals with variable values

**Conditional Logic:**
- Weekend detection: Lines 135-139
- Monday special case: Lines 141-143
- Friday special case: Lines 145-147

---

#### ASK-CONTINUE SECTION (Lines 149-158)
**Purpose:** Prompt user to continue or exit program

**Logic Flow:**
1. Prompt user for continue response (Y/N)
2. Accept user input
3. Normalize input:
   - If 'y' or 'Y': set WS-CONTINUE-FLAG to 'Y'
   - Otherwise: set WS-CONTINUE-FLAG to 'N'

**Variables Modified:**
- WS-CONTINUE-FLAG (Lines 152-157)

**Input Handling:**
- Case-insensitive (accepts both 'y' and 'Y')
- Any value other than 'y'/'Y' treated as 'N'

---

### Paragraph/Section Call Relationships

```
MAIN-PROCEDURE (Entry Point)
│
├── PERFORM GET-YEAR-INPUT
│   └── Validates user input (1600-3000)
│
├── PERFORM CALCULATE-DAY-OF-WEEK (conditional on no errors)
│   └── Uses intrinsic date functions
│
├── PERFORM DISPLAY-RESULT (conditional on no errors)
│   └── Formats and displays results
│
└── PERFORM ASK-CONTINUE
    └── Controls loop continuation

GOBACK (Exit Point)
```

### Embedded SQL/DB2 Statements
**None found** - This program does not use embedded SQL or database access.

### File Access Patterns
**None found** - This program does not use file I/O.
- No FILE-CONTROL section defined
- No FD (File Description) entries
- No OPEN, READ, WRITE, CLOSE statements
- Uses ACCEPT/DISPLAY for user interaction only

### Key Features & Algorithms

1. **Date Calculation Algorithm:**
   - Uses COBOL intrinsic function INTEGER-OF-DATE
   - Converts date to integer representation
   - Applies modulo 7 to determine day of week
   - Maps result to day name lookup table

2. **Input Validation:**
   - Year range: 1600-3000
   - Error flag pattern for flow control

3. **User Interface:**
   - Interactive console-based
   - Loop-until-exit pattern
   - Case-insensitive input handling

4. **Data Structure Techniques:**
   - REDEFINES clause for array access
   - OCCURS clause for table definition
   - Group items for logical data organization

5. **COBOL Language Features Demonstrated:**
   - PERFORM UNTIL loop
   - PERFORM VARYING loop structure (not used, but structure present)
   - STRING verb for formatted output
   - Intrinsic functions (INTEGER-OF-DATE, MOD)
   - REDEFINES and OCCURS for table handling
   - Reference modification for substring operations

---

## TESTCDAY.CBLLE - Test Program

### Program Identification
- **Program ID:** TESTCDAY
- **Author:** Development Team
- **Date Written:** July 21, 2025
- **Purpose:** Demonstrates automated testing of CANDAY01 (Note: actual calling mechanism not implemented)

### Data Division

#### Working-Storage Section

##### 1. Test Years Array (Lines 15-23)
```
01 WS-TEST-YEARS          (Group Level - Data Definition)
   - Level: 01
   - Type: Group item containing test year values
   - Purpose: Stores predefined test years
   
   05 FILLER              PIC 9(4) VALUE 2024
   05 FILLER              PIC 9(4) VALUE 2025
   05 FILLER              PIC 9(4) VALUE 2026
   05 FILLER              PIC 9(4) VALUE 1867 (Confederation year)
   05 FILLER              PIC 9(4) VALUE 2030
   
01 WS-TEST-ARRAY REDEFINES WS-TEST-YEARS
   - REDEFINES: WS-TEST-YEARS (same memory space)
   - Purpose: Array accessor for test years
   
   05 WS-TEST-YEAR        PIC 9(4) OCCURS 5 TIMES
      - Level: 05
      - Type: Numeric array
      - Size: 4 digits per entry
      - Occurrences: 5 test cases
      - Purpose: Individual test year accessor
```

##### 2. Loop Control (Line 25)
```
01 WS-INDEX               PIC 9(2) VALUE 1
   - Level: 01
   - Type: Numeric
   - Size: 2 digits
   - Purpose: Loop counter for PERFORM VARYING
   - Initial Value: 1
```

### Procedure Division

#### MAIN-PROCEDURE (Lines 29-40)
**Purpose:** Entry point and test execution controller

**Logic Flow:**
1. Display test header
2. Execute PERFORM VARYING loop:
   - Iterate from 1 to 5 (WS-INDEX)
   - For each iteration, PERFORM TEST-YEAR
3. Display completion message
4. GOBACK

**Loop Structure:**
- Type: PERFORM VARYING
- Control Variable: WS-INDEX
- Range: 1 to 5
- Increment: BY 1

**Calls/Performs:**
- `PERFORM TEST-YEAR` (Line 35)

**Exit:** GOBACK (Line 40)

---

#### TEST-YEAR SECTION (Lines 42-45)
**Purpose:** Process each test year (stub implementation)

**Logic Flow:**
1. Display current test year being processed
2. Display note about implementation status

**Variables Referenced:**
- WS-TEST-YEAR(WS-INDEX) - subscripted array access

**Note:** This is a stub implementation. The comment on line 45 indicates that in a production version, this would call CANDAY01 to perform actual testing.

---

### Paragraph/Section Call Relationships

```
MAIN-PROCEDURE (Entry Point)
│
└── PERFORM VARYING (loop 5 times)
    └── PERFORM TEST-YEAR
        └── Display test year (stub)

GOBACK (Exit Point)
```

### Embedded SQL/DB2 Statements
**None found** - This program does not use embedded SQL or database access.

### File Access Patterns
**None found** - This program does not use file I/O.
- No FILE-CONTROL section defined
- No FD (File Description) entries
- Uses DISPLAY for output only

### Key Features

1. **Test Data Structure:**
   - Hardcoded test years in array
   - Includes historical year (1867 - Canadian Confederation)
   - Includes recent and future years (2024-2030)

2. **Array Processing:**
   - REDEFINES for array access
   - OCCURS 5 TIMES for array definition
   - Subscripted array reference: WS-TEST-YEAR(WS-INDEX)

3. **Loop Control:**
   - PERFORM VARYING for indexed iteration
   - Counter-controlled loop (1 to 5)

4. **Design Pattern:**
   - Test driver pattern
   - Stub implementation for demonstration

---

## Cross-Program Relationships

### Program Dependencies

```
TESTCDAY.CBLLE
    │
    └── [Intended] CANDAY01.CBLLE
        (Not implemented - noted in comments)
```

### Integration Notes

1. **Current Implementation:**
   - TESTCDAY is a standalone stub
   - Does not actually call CANDAY01
   - Serves as framework/template for future integration

2. **Intended Design:**
   - TESTCDAY should invoke CANDAY01 for each test year
   - Would require one of the following mechanisms:
     - CALL statement to invoke CANDAY01 as subprogram
     - Shared data area for passing parameters
     - File-based or queue-based communication

3. **Potential Integration Methods:**
   ```cobol
   * Method 1: Static Call
   CALL 'CANDAY01' USING WS-TEST-YEAR(WS-INDEX)
   
   * Method 2: Dynamic Call
   CALL WS-PROGRAM-NAME USING WS-PARAMETERS
   
   * Method 3: Modify CANDAY01 for batch processing
   ```

4. **Data Flow (Proposed):**
   ```
   TESTCDAY → [Year Input] → CANDAY01 → [Day Result] → Validation
   ```

### Test Coverage

**Test Cases Defined:**
1. 2024 - Recent past/current year
2. 2025 - Current/near future year
3. 2026 - Future year
4. 1867 - Historical significant year (Canadian Confederation)
5. 2030 - Future year for long-term planning

**Test Characteristics:**
- Mix of historical and future dates
- Includes significant historical year
- Covers reasonable range for business use cases
- Does not test boundary conditions (1600, 3000)

---

## Summary

### Program Statistics

| Metric | CANDAY01 | TESTCDAY |
|--------|----------|----------|
| Total Lines | 161 | 48 |
| Divisions | 4 | 2 |
| Sections | 4 | 2 |
| Working-Storage Variables (01 level) | 11 | 3 |
| Group Items | 3 | 2 |
| Elementary Items | 8 | 1 |
| PERFORM Statements | 5 | 2 |
| Conditional Statements | 7 | 0 |
| DISPLAY Statements | 28 | 7 |
| ACCEPT Statements | 2 | 0 |

### Data Structures Summary

**CANDAY01 Data Organization:**
- Input/Output: 2 items (WS-INPUT-YEAR, WS-INPUT-YEAR-DISPLAY)
- Date Structures: 3 items (WS-CANADA-DATE group, WS-DATE-NUMERIC, WS-DATE-FORMATTED)
- Day Calculation: 2 items (WS-DAY-OF-WEEK, WS-DAY-NAME)
- Lookup Table: 2 items (WS-DAY-TABLE, WS-DAY-NAMES with 7 entries)
- Control Flags: 2 items (WS-ERROR-FLAG, WS-CONTINUE-FLAG)
- Formatting: 1 item (WS-DISPLAY-LINE)

**TESTCDAY Data Organization:**
- Test Data: 2 items (WS-TEST-YEARS group, WS-TEST-ARRAY with 5 entries)
- Loop Control: 1 item (WS-INDEX)

### Logic Complexity

**CANDAY01:**
- Complexity: Medium
- Control Structures: PERFORM UNTIL, nested IF statements, PERFORM VARYING (structure)
- Algorithm Complexity: Low (uses intrinsic functions)
- User Interaction: High (interactive console program)

**TESTCDAY:**
- Complexity: Low
- Control Structures: PERFORM VARYING
- Algorithm Complexity: Minimal (stub implementation)
- User Interaction: Low (display only)

### SQL/Database Usage
- **None** in either program
- Both programs are self-contained
- No external data dependencies
- No file I/O operations

### File Operations
- **None** in either program
- CANDAY01 uses ACCEPT/DISPLAY for console I/O
- TESTCDAY uses DISPLAY for output
- No file definitions or file processing

### Code Quality Observations

**Strengths:**
1. Clear, descriptive variable names with prefixes (WS-)
2. Well-structured with logical sections
3. Good use of COBOL features (REDEFINES, OCCURS, intrinsic functions)
4. Comprehensive comments and documentation
5. Input validation with error handling
6. User-friendly interface with formatted output
7. Modular design with separate sections for each function

**Areas for Enhancement:**
1. TESTCDAY is incomplete (stub only)
2. WS-DATE-FORMATTED defined but unused in CANDAY01
3. Error handling could include invalid input type handling
4. No logging or audit trail
5. Could benefit from parameterized entry point for batch processing
6. Test program could include expected results for validation

### Platform Considerations

**AS/400 Specific Features:**
- .CBLLE extension indicates ILE COBOL for AS/400
- DECIMAL-POINT IS COMMA configuration (European numeric format)
- Uses standard COBOL intrinsic functions (portable)
- GOBACK for program termination (AS/400 standard)

**Portability:**
- Most code is standard COBOL and portable
- INTEGER-OF-DATE function is standard COBOL intrinsic
- DECIMAL-POINT IS COMMA would need adjustment for other locales
- Interactive ACCEPT/DISPLAY works on most platforms

### Maintenance Recommendations

1. **Complete TESTCDAY Implementation:**
   - Add actual CALL to CANDAY01
   - Implement result validation
   - Add expected results table for comparison

2. **Enhanced Error Handling:**
   - Add input type validation
   - Handle non-numeric input gracefully
   - Add error logging

3. **Documentation:**
   - Add inline comments for complex calculations
   - Document the day-of-week algorithm more explicitly
   - Add examples of expected output

4. **Testing:**
   - Add boundary condition tests (1600, 3000)
   - Test leap year handling
   - Test century transitions
   - Add regression test suite

5. **Code Cleanup:**
   - Remove or utilize WS-DATE-FORMATTED
   - Consider parameterized version for batch use
   - Add return code for success/failure indication

---

## Detailed Variable Cross-Reference

### CANDAY01 Variables

| Variable Name | Type | Level | Size | Usage Count | Sections Used |
|---------------|------|-------|------|-------------|---------------|
| WS-INPUT-YEAR | 9(4) | 01 | 4 | 4 | GET-YEAR-INPUT (2), DISPLAY-RESULT (1), MAIN-PROCEDURE (1) |
| WS-INPUT-YEAR-DISPLAY | Z(4) | 01 | 4 | 2 | DISPLAY-RESULT |
| WS-CANADA-DATE | Group | 01 | - | 0 | (group only) |
| WS-YEAR | 9(4) | 05 | 4 | 3 | GET-YEAR-INPUT (1), CALCULATE-DAY-OF-WEEK (2) |
| WS-MONTH | 9(2) | 05 | 2 | 1 | CALCULATE-DAY-OF-WEEK |
| WS-DAY | 9(2) | 05 | 2 | 1 | CALCULATE-DAY-OF-WEEK |
| WS-DAY-OF-WEEK | 9(1) | 01 | 1 | 4 | CALCULATE-DAY-OF-WEEK |
| WS-DAY-NAME | X(9) | 01 | 9 | 4 | CALCULATE-DAY-OF-WEEK (1), DISPLAY-RESULT (3) |
| WS-DATE-NUMERIC | 9(8) | 01 | 8 | 2 | CALCULATE-DAY-OF-WEEK |
| WS-DATE-FORMATTED | X(10) | 01 | 10 | 0 | (unused) |
| WS-DAY-TABLE | Group | 01 | 63 | 0 | (table definition) |
| WS-DAY-NAMES | Group | 01 | 63 | 0 | (REDEFINES) |
| WS-DAY-ENTRY | X(9) | 05 | 9 | 1 | CALCULATE-DAY-OF-WEEK |
| WS-ERROR-FLAG | X(1) | 01 | 1 | 4 | GET-YEAR-INPUT (2), MAIN-PROCEDURE (1) |
| WS-CONTINUE-FLAG | X(1) | 01 | 1 | 5 | MAIN-PROCEDURE (1), ASK-CONTINUE (4) |
| WS-DISPLAY-LINE | X(80) | 01 | 80 | 2 | DISPLAY-RESULT |

### TESTCDAY Variables

| Variable Name | Type | Level | Size | Usage Count | Sections Used |
|---------------|------|-------|------|-------------|---------------|
| WS-TEST-YEARS | Group | 01 | 20 | 0 | (group only) |
| WS-TEST-ARRAY | Group | 01 | 20 | 0 | (REDEFINES) |
| WS-TEST-YEAR | 9(4) | 05 | 4 | 1 | TEST-YEAR |
| WS-INDEX | 9(2) | 01 | 2 | 2 | MAIN-PROCEDURE |

---

## End of Analysis Report

**Report Generated For:**
- CANDAY01.CBLLE (161 lines)
- TESTCDAY.CBLLE (48 lines)

**Total Programs Analyzed:** 2  
**Total Lines of Code:** 209  
**Analysis Completion:** Successful

---
